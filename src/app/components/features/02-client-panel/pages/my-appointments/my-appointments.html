<div class="appointments-container">
  <h1 class="title">Mis Citas</h1>
  <p class="subtitle">Aquí puedes ver tus citas agendadas y tu historial.</p>

  <!-- Loader -->
  <mat-progress-bar *ngIf="loading" mode="indeterminate"></mat-progress-bar>

  <!-- Cuando no hay citas -->
  <div
    *ngIf="!loading && upcomingAppointments.length === 0 && historyAppointments.length === 0"
    class="empty-state">
    No se encontraron citas agendadas.
  </div>

  <!-- Próximas citas -->
  <div *ngIf="!loading && upcomingAppointments.length > 0" class="section">
    <h2 class="section-title">Próximas citas</h2>

    <table mat-table [dataSource]="upcomingAppointments" class="appointments-table mat-elevation-z1">

      <!-- Profesional -->
      <ng-container matColumnDef="professional">
        <th mat-header-cell *matHeaderCellDef> Profesional </th>
        <td mat-cell *matCellDef="let row">
          {{ row.professionalName }} {{ row.professionalLastname }}
        </td>
      </ng-container>

      <!-- Fecha -->
      <ng-container matColumnDef="date">
        <th mat-header-cell *matHeaderCellDef> Fecha </th>
        <td mat-cell *matCellDef="let row"> {{ row.date }} </td>
      </ng-container>

      <!-- Hora -->
      <ng-container matColumnDef="time">
        <th mat-header-cell *matHeaderCellDef> Hora </th>
        <td mat-cell *matCellDef="let row">
          {{ row.timeStart | slice:0:5 }} - {{ row.timeEnds | slice:0:5 }}
        </td>
      </ng-container>

      <!-- Estado -->
      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef> Estado </th>
        <td mat-cell *matCellDef="let row"> {{ row.status }} </td>
      </ng-container>

      <ng-container matColumnDef="actions">
        <th mat-header-cell *matHeaderCellDef> Acciones </th>
        <td mat-cell *matCellDef="let row">
          <button
            mat-button
            color="warn"
            *ngIf="row.status === 'PROGRAMADA' || row.status === 'CONFIRMADA'"
            (click)="cancelAppointment(row)">
            Cancelar
          </button>
        </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumnsUpcoming"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumnsUpcoming;"></tr>
    </table>
  </div>

  <!-- Historial -->
  <div *ngIf="!loading && historyAppointments.length > 0" class="section">
    <h2 class="section-title">Historial</h2>

    <table mat-table [dataSource]="historyAppointments" class="appointments-table mat-elevation-z1">

      <!-- Reutilizamos las mismas columnas pero sin 'actions' -->
      <ng-container matColumnDef="professional">
        <th mat-header-cell *matHeaderCellDef> Profesional </th>
        <td mat-cell *matCellDef="let row">
          {{ row.professionalName }} {{ row.professionalLastname }}
        </td>
      </ng-container>

      <ng-container matColumnDef="date">
        <th mat-header-cell *matHeaderCellDef> Fecha </th>
        <td mat-cell *matCellDef="let row"> {{ row.date }} </td>
      </ng-container>

      <ng-container matColumnDef="time">
        <th mat-header-cell *matHeaderCellDef> Hora </th>
        <td mat-cell *matCellDef="let row">
          {{ row.timeStart | slice:0:5 }} - {{ row.timeEnds | slice:0:5 }}
        </td>
      </ng-container>

      <ng-container matColumnDef="status">
        <th mat-header-cell *matHeaderCellDef> Estado </th>
        <td mat-cell *matCellDef="let row"> {{ row.status }} </td>
      </ng-container>

      <tr mat-header-row *matHeaderRowDef="displayedColumnsHistory"></tr>
      <tr mat-row *matRowDef="let row; columns: displayedColumnsHistory;"></tr>
    </table>
  </div>
</div>

